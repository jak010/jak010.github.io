---
title: "CH04 : 불변 활용하기"
excerpt: 내 코드가 그렇게 이상한가요
categories:
  - books
tags: 
permalink: /categories/book/is_my_code_really_that_weird/ch04
toc: true
toc_sticky: true
date: 2025-07-19
last_modified_at: 2025-07-21
---

# CHAPTER 4 : 불변 활용하기
> 범위 : 42p ~ 57p  
> 단계 : 실전  
> 제목 : 불변 활용하기, 안정적으로 동작하게 만들기  
> 내용 : 예측할 수 있는 코드를 작성하는데 필요한 불변성을 다룹니다.  

# INTRO
이 장에서는 3장에서 다루었던 가변과 불변에 대해서 자세히 설명합니다.

변수의 값을 변경하는 등 상태를 변경할 수 있는 것을 `가변(mutable)`이라고 합니다. 반면 상태를 변경할 수 없는 것을 `불변(immutable)` 이라고 합니다.

가변과 불변을 적절하게 설계하지 못하면 동작들이 예측하기 어렵고 혼란스러워 집니다.
- 예를 들어서 '이 값은 이렇게 변경될 것이다'라고 생각하고 구현했는데, 의도하지 않은 다른 값으로 변경되는 상황이 생길 수 있습니다.

가능한 한 상태가 변경되지 않도록 설계해야합니다. 이때 불변이라는 개념이 활용됩니다. 불변은 최근 프로그래밍 스타일의 표준 트렌드라고 할 수 있습니다.

## 4.1 재할당
변수에 값을 다시 할당하는 것을 `재할당` 또는 `파괴적 할당` 이라고 합니다.
- 재할당은 변수의 의미를 바꿔 추측하기 어렵게 만듭니다. 또한 언제 어떻게 변경되었는지 추적하기 힘들게 합니다.

아래는 데미지를 계산하는 코드입니다.
```java
int damage(){
	int tmp = member.power() + member.weaponAttack();
	tmp = (int)(tmp * (1f + member.speed() / 100f ));
	tmp = tmp - (int)(enemy.defence / 2);
	tmp = Math.max(0, tmp);
	return tmp
}
```
다양한 값을 가져와 최종 대미지를 구하는 과정에서 변수  tmp를 계속 재사용하고 있습니다.  변수 tmp는 기본 공격력, 보정, 값, 대미지 등이 계속 재할당되면서 값의 의미가 바뀝니다.

중간에 의미가 바뀌면, 읽는 사람은 헷갈릴 수 밖에 없습니다. 헷갈리면 버그를 만들어 낼 가능성이 높아집니다. 

`따라서 재할당은 피하는 것이 좋습니다.`
- 변수 하나를 재활용하지 않고, 계속해서 새로운 변수를 만들어 사용하면 재할당을 피할 수 있습니다.

### 4.1.1 불변 변수로 만들어서 재할당 막기
재할당을 기계적으로 막을 수 있는 방법은 변수에 final 수식자를 붙이면 된다.`final을 붙인 변수는 변경할 수 없다.` 따라서 다음과 같이 작성하면 컴파인 단계에서 오류가 발생한다.
```java
void doSomething() {
	final int value = 100;
	value = 200; // compile error
}
```

### 4.1.2 매개변수도 불변으로 만들기
매개변수도 마찬가지이다. 매개변수를 변경하면 값의 의미가 바뀔 수 있다. 이렇게 의미가 바뀌면 코드를 읽는 사람이 헷갈리므로 버그의 원인이 될 수 있다.
```java
// 코드 4.4 : 매개변수 productPrice에 재할당하는 코드

void addPrice(int productPrice) {
	productPrice = totalPrice  + productPrice;
	if(MAX_TOTAL_PRICE < productPrice) {
		throw new IllegalArgumentException("구매 상한 금액을 넘었습니다.")
	}

}

```